<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NFC读取并写入多维表</title>
    <!-- 引入钉钉JSAPI -->
    <script src="//g.alicdn.com/dingding/open-develop/1.6.9/dingtalk.js"></script>
</head>
<body>
    <button onclick="readNFC()">读取NFC芯片</button>

    <script>
        // 配置钉钉JSAPI权限
        dd.config({
            agentId: "你的企业应用AgentId", // 替换为企业应用AgentId
            corpId: "你的企业CorpId",       // 替换为企业CorpId
            timeStamp: "",                  // 时间戳
            nonceStr: "",                   // 随机字符串
            signature: "",                  // 签名（需后端生成）
            jsApiList: ["device.nfc.nfcRead", "biz.dataV.multiTable.create"]
        });

        function readNFC() {
            dd.ready(function () {
                // 调用NFC读取
                dd.device.nfc.nfcRead({
                    onSuccess: function (data) {
                        const nfcContent = data.content; // 读取到的NFC数据（如 "编号:123, 名字:张三"）
                        const [id, name] = parseNFCData(nfcContent); // 解析编号和名字
                        const now = new Date();
                        const date = now.toISOString().split('T')[0]; // 日期（如 2025-10-13）
                        const time = now.toLocaleTimeString();         // 时间（如 19:03:08）

                        // 写入多维表
                        writeMultiTable(id, name, date, time);
                    },
                    onFail: function (err) {
                        alert("NFC读取失败: " + JSON.stringify(err));
                    }
                });
            });
        }

        function parseNFCData(content) {
            // 根据实际NFC数据格式解析编号和名字
            const parts = content.split(",");
            const id = parts[0].match(/编号:(\d+)/)[1];
            const name = parts[1].match(/名字:(\S+)/)[1];
            return [id, name];
        }

        function writeMultiTable(id, name, date, time) {
            dd.biz.dataV.multiTable.create({
                tableId: "你的多维表ID", // 替换为多维表ID
                record: {
                    "编号": id,
                    "名字": name,
                    "日期": date,
                    "时间": time
                },
                onSuccess: function () {
                    alert("数据写入成功！");
                },
                onFail: function (err) {
                    alert("写入失败: " + JSON.stringify(err));
                }
            });
        }
    </script>
</body>
</html>